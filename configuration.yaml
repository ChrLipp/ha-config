
# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# SSL Access
http:
#  base_url: !secret base_url
  ssl_certificate: !secret ssl_certificate
  ssl_key: !secret ssl_key
  ip_ban_enabled: True
  login_attempts_threshold: 2

# Text to speech
tts:
  - platform: google_translate

# Apple home kit
homekit:
  filter:
    include_entities:
      - light.elias_light

media_player:
  - platform: enigma2
    host: 10.0.0.104
    mac_address: !secret vuplus_mac
    password: !secret vusolo4k_password
    name: "Vu+ Solo4K"
  - platform: samsungtv_custom
    host: 10.0.0.103
    mac: !secret sasmsung_mac
    port: 8002
    timeout: 30
    protocol: ws
    sourcelist: '{"AV-Receiver": "KEY_HDMI1", "Receiver": "KEY_HDMI2", "Switch": "KEY_HDMI3", "Mac": "KEY_HDMI4"}'

switch:
  - platform: wake_on_lan
    host: 10.0.0.102
    mac: !secret arbeitszimmer_mac
    name: "Arbeitszimmer"
  - platform: wake_on_lan
    host: 10.0.0.101
    mac: !secret diskstation_mac
    name: "Diskstation"

telegram_bot:
  - platform: broadcast
    api_key: !secret telegram_token
    allowed_chat_ids:
      - !secret telegram_chat_id

notify:
  - name: telegram
    platform: telegram
    chat_id: !secret telegram_chat_id

automower:
  username: !secret husqvarna_username
  password: !secret husqvarna_password

camera:
  name: Miki
  platform: generic
  still_image_url: !secret husqvarna_maps_url
  limit_refetch_to_url_change: true


input_boolean:
  elias_alarm_switch:
    name: Elias Wecker einschalten
    icon: mdi:alarm-check
input_datetime:
  elias_alarm_time:
    name: Elias Wecker Uhrzeit
    has_date: false
    has_time: true
    icon: mdi:alarm
input_text:
  last_known_version_update:
    name: Last known (and notified) version available for update
    icon: mdi:message-settings-variant-outline

sensor:
  - platform: version
    name: Current HA version
    source: local
  - platform: version
    name: Last HA version
    source: hassio
  - platform: time_date
    display_options:
      - 'time'
  - platform: waste_at_bmv
    ort: !secret bmv_ort
    strasse: !secret bmv_strasse
    hausnummer: !secret bmv_hausnummer
  - platform: template
    sensors:
      gelbersack_text:
        value_template: "{{states.sensor.waste_gelber_sack.attributes.display_text_long}}"
        friendly_name: 'Gelber Sack'
        icon_template: mdi:sack
      papiertonne_text:
        value_template: "{{states.sensor.waste_papier.attributes.display_text_long}}"
        friendly_name: 'Papier'
        icon_template: mdi:delete-empty
      restmuell_text:
        value_template: "{{states.sensor.waste_restmull.attributes.display_text_long}}"
        friendly_name: 'Restmüll'
        icon_template: mdi:trash-can-outline
      update_available:
        friendly_name: "Home assistant update available"
        value_template: >-
          {% if states("sensor.last_ha_version") ==  "unknown" %}
            false
          {% elif states("sensor.last_ha_version") ==  states("input_text.last_known_version_update") %}
            false
          {% else %}
            true
          {% endif %}
      miki_status:
        friendly_name: "Miki"
        entity_picture_template: "{{state_attr('camera.miki', 'entity_picture')}}"
        value_template: "{{states('device_tracker.automower_h_170805572_164914249')}}"

fan:
  - platform: template
    fans:
      ventilation_fan:
        friendly_name: "Wohnraumlüftung"
        value_template: >-
          {% if states('switch.switch_ventilation_relay_1') == 'on' %}
            off
          {% else %}
            on
          {% endif %}
        speed_template: >-
          {% if states('switch.switch_ventilation_relay_2') == 'on' %}
            medium
          {% elif states('switch.switch_ventilation_relay_3') == 'on' %}
            high
          {% else %}
            low
          {% endif %}
        turn_on:
          service: switch.turn_off
          data:
            entity_id: switch.switch_ventilation_relay_1
        turn_off:
          service: switch.turn_on
          data:
            entity_id: switch.switch_ventilation_relay_1
        set_speed:
          service_template: >-
            {% if speed == 'low' %}
              script.ventilation_fan_1
            {% elif speed == 'medium' %}
              script.ventilation_fan_2
            {% elif speed == 'high' %}
              script.ventilation_fan_3
            {% endif %}
        speeds:
          - 'low'
          - 'medium'
          - 'high'

frontend:
  themes: !include_dir_merge_named themes

lovelace:
  mode: yaml
  resources:
    - type: module
      url: /hacsfiles/custom-header/custom-header.js
    - type: module
      url: /hacsfiles/lovelace-time-picker-card/time-picker-card.js
    - type: module
      url: /hacsfiles/fan-control-entity-row/fan-control-entity-row.js

logger:
  default: info
  logs:
    custom_components.waste_at_bmv: debug

logbook:
  exclude:
    entities:
      - automation.notify_garbage_gelber_sack
      - automation.notify_garbage_papier
      - automation.notify_garbage_restmull
      - automation.service_make_full_backup
      - automation.update_available_notification
      - device_tracker.automower_h_170805572_164914249
      - device_tracker.christian_iphone
      - input_datetime.elias_alarm_time
      - sensor.christian_activity
      - sensor.christian_average_active_pace
      - sensor.christian_battery_level
      - sensor.christian_battery_state
      - sensor.christian_bssid
      - sensor.christian_connection_type
      - sensor.christian_distance
      - sensor.christian_floors_ascended
      - sensor.christian_floors_descended
      - sensor.christian_geocoded_location
      - sensor.christian_last_update_trigger
      - sensor.christian_sim_1
      - sensor.christian_ssid
      - sensor.christian_steps
      - sensor.current_ha_version
      - sensor.elias_iphone_activity
      - sensor.elias_iphone_average_active_pace
      - sensor.elias_iphone_battery_level
      - sensor.elias_iphone_battery_state
      - sensor.elias_iphone_bssid
      - sensor.elias_iphone_connection_type
      - sensor.elias_iphone_distance
      - sensor.elias_iphone_floors_ascended
      - sensor.elias_iphone_floors_descended
      - sensor.elias_iphone_geocoded_location
      - sensor.elias_iphone_last_update_trigger
      - sensor.elias_iphone_sim_1
      - sensor.elias_iphone_ssid
      - sensor.elias_iphone_steps
      - sensor.gelbersack_text
      - sensor.last_ha_version
      - sensor.papiertonne_text
      - sensor.plug_wlan_anna_chain_of_lights_esphome_version
      - sensor.restmuell_text
      - sensor.time
      - sensor.waste_gelber_sack
      - sensor.waste_papier
      - sensor.waste_restmull
      - sun.sun
      - switch.plug_wlan_anna_chain_of_lights_reboot
      - switch.switch_wlan_elias_light_reboot

history:
  exclude:
    entities:
      - automation.notify_garbage_gelber_sack
      - automation.notify_garbage_papier
      - automation.notify_garbage_restmull
      - automation.service_make_full_backup
      - automation.update_available_notification
      - binary_sensor.updater
      - device_tracker.automower_h_170805572_164914249
      - input_text.last_known_version_update
      - input_boolean.elias_alarm_switch
      - input_datetime.elias_alarm_time
      - light.plug_wlan_anna_chain_of_lights_blue_led
      - light.plug_wlan_anna_chain_of_lights_red_led
      - light.wohnzimmer
      - persistent_notification.config_entry_discovery
      - sensor.battery_level
      - sensor.battery_state
      - sensor.bssid
      - sensor.christian_activity
      - sensor.christian_average_active_pace
      - sensor.christian_battery_level
      - sensor.christian_battery_state
      - sensor.christian_bssid
      - sensor.christian_connection_type
      - sensor.christian_distance
      - sensor.christian_floors_ascended
      - sensor.christian_floors_descended
      - sensor.christian_last_update_trigger
      - sensor.christian_sim_1
      - sensor.christian_ssid
      - sensor.christian_steps
      - sensor.elias_iphone_activity
      - sensor.elias_iphone_average_active_pace
      - sensor.elias_iphone_battery_level
      - sensor.elias_iphone_battery_state
      - sensor.elias_iphone_bssid
      - sensor.elias_iphone_connection_type
      - sensor.elias_iphone_distance
      - sensor.elias_iphone_floors_ascended
      - sensor.elias_iphone_floors_descended
      - sensor.elias_iphone_geocoded_location
      - sensor.elias_iphone_last_update_trigger
      - sensor.elias_iphone_sim_1
      - sensor.elias_iphone_ssid
      - sensor.elias_iphone_steps
      - sensor.current_ha_version
      - sensor.gelbersack_text
      - sensor.geocoded_location
      - sensor.last_ha_version
      - sensor.last_update_trigger
      - sensor.papiertonne_text
      - sensor.plug_wlan_anna_chain_of_lights_esphome_version
      - sensor.restmuell_text
      - sensor.sim_1
      - sensor.ssid
      - sensor.time
      - sensor.update_available
      - sensor.waste_gelber_sack
      - sensor.waste_papier
      - sensor.waste_restmull
      - switch.elias_light_reboot
      - switch.plug_wlan_anna_chain_of_lights_reboot
      - switch.switch_wlan_elias_light_reboot

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
